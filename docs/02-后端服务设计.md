# 02 - 后端服务设计

## 技术栈

- **语言**: Rust
- **Web 框架**: `axum`
- **异步运行时**: `tokio`
- **序列化/反序列化**: `serde`, `serde_json`, `serde_yaml`
- **CLI 调用**: `tokio::process::Command`

## 核心职责

1.  **CLI 封装**: 将 `confkit/engine` 的子命令封装为 RESTful API 端点。
2.  **工作区管理**: 扫描、解析和修改 `.confkit/spaces/` 目录下的 YAML 配置文件。
3.  **实时通信**: 通过 WebSocket 向前端实时推送 `engine` 的输出（如构建日志）。

## API 端点定义

| 方法   | 路径                                     | 描述                                     | 请求体 (Body)        | 响应 (Response)                             |
|--------|------------------------------------------|------------------------------------------|----------------------|---------------------------------------------|
| `GET`  | `/api/workspaces`                        | 获取所有工作区 (spaces) 的列表           | -                    | `application/json` - `[{name, ...}]`        |
| `GET`  | `/api/workspaces/{space_name}`           | 获取指定工作区的详细配置                 | -                    | `application/json` - `{...space_config}`    |
| `PUT`  | `/api/workspaces/{space_name}`           | 更新指定工作区的配置                     | `application/json`   | `200 OK` 或 `404 Not Found`                 |
| `POST` | `/api/workspaces`                        | 创建一个新的工作区                       | `application/json`   | `201 Created`                               |
| `POST` | `/api/workspaces/{space_name}/actions/build` | 触发指定工作区的构建任务                 | `{}` (可扩展)        | `202 Accepted` - 表示任务已开始             |
| `WS`   | `/ws/workspaces/{space_name}/logs`       | 建立 WebSocket 连接以接收实时日志        | -                    | (WebSocket Stream)                          |

