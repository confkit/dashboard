# 04 - å®ç°è®¡åˆ’

## ğŸ“Š å½“å‰è¿›åº¦åˆ†æ

### âœ… å·²å®Œæˆ
- æ¶æ„è®¾è®¡æ–‡æ¡£å®Œæ•´
- Monorepo ç»“æ„ (pnpm workspace) å·²é…ç½®
- åç«¯åŸºç¡€æ¡†æ¶ (axum server + å ä½ç¬¦ API)
- å‰ç«¯åŒ…ä¾èµ–å®‰è£…å®Œæˆ

### âŒ ç¼ºå¤±éƒ¨åˆ†

**åç«¯ (Backend Service)**
- å·¥ä½œåŒºæ‰«æé€»è¾‘ (è¯»å– `.confkit/spaces/` ç›®å½•)
- å•ä¸ªå·¥ä½œåŒºé…ç½®è·å–/æ›´æ–° API
- æ„å»ºè§¦å‘ API (è°ƒç”¨ `confkit/engine`)
- WebSocket å®æ—¶æ—¥å¿—æ¨é€
- CLI è¿›ç¨‹ç®¡ç† (stdout/stderr è§£æ)
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—

**å‰ç«¯ (Frontend App)**
- `app/src/` å®Œå…¨ç¼ºå¤±
- `packages/ui/src/` å®Œå…¨ç¼ºå¤±
- é¡µé¢è·¯ç”± (åŸºäº `@fukict/router`)
- API æœåŠ¡å±‚ (HTTP/WS å®¢æˆ·ç«¯)
- UI ç»„ä»¶åº“ (Button, Card, Table ç­‰)
- ä¸‰ä¸ªæ ¸å¿ƒé¡µé¢å®ç°

---

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

### Phase 1: æ ¸å¿ƒåŸºç¡€ (ä¼˜å…ˆ)
**ç›®æ ‡**: å»ºç«‹åŸºæœ¬å¯ç”¨çš„åŸå‹

#### 1.1 åç«¯æ ¸å¿ƒ API
- `GET /api/workspaces` - æ‰«ææ–‡ä»¶ç³»ç»Ÿ,è¿”å›å·¥ä½œåŒºåˆ—è¡¨
- `GET /api/workspaces/{name}` - è¯»å–å•ä¸ª YAML é…ç½®
- `PUT /api/workspaces/{name}` - æ›´æ–° YAML é…ç½®

#### 1.2 å‰ç«¯åŸºç¡€ç»„ä»¶åº“
åœ¨ `packages/ui/src/` åˆ›å»º:
- `Button.tsx` - åŸºç¡€æŒ‰é’®
- `Card.tsx` - å¡ç‰‡å®¹å™¨
- `Input.tsx` - è¡¨å•è¾“å…¥
- `index.ts` - ç»Ÿä¸€å¯¼å‡º

#### 1.3 å‰ç«¯ä¸»åº”ç”¨æ¡†æ¶
åœ¨ `app/src/` åˆ›å»º:
- `main.tsx` - åº”ç”¨å…¥å£
- `App.tsx` - æ ¹ç»„ä»¶ + è·¯ç”±é…ç½®
- `services/api.ts` - HTTP å®¢æˆ·ç«¯å°è£…
- `pages/Dashboard.tsx` - å·¥ä½œåŒºåˆ—è¡¨é¡µ (é¦–é¡µ)

---

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (æ¬¡è¦)
**ç›®æ ‡**: å®ç°ç¼–è¾‘å’Œæ„å»ºåŠŸèƒ½

#### 2.1 åç«¯æ„å»º API
- `POST /api/workspaces/{name}/actions/build` - è§¦å‘æ„å»º
- CLI è¿›ç¨‹ç®¡ç† (è°ƒç”¨ `confkit/engine build`)
- è¾“å‡ºç¼“å†²å’Œè§£æ

#### 2.2 å‰ç«¯ç¼–è¾‘é¡µ
- `pages/WorkspaceEditor.tsx` - é…ç½®ç¼–è¾‘é¡µ
- `ui/CodeEditor.tsx` - YAML ç¼–è¾‘å™¨ç»„ä»¶ (åŸºäº `<textarea>` æˆ–ç®€å•ç¼–è¾‘å™¨)
- è¡¨å•éªŒè¯å’Œä¿å­˜é€»è¾‘

---

### Phase 3: å®æ—¶æ—¥å¿— (æ‰©å±•)
**ç›®æ ‡**: WebSocket å®æ—¶æ—¥å¿—æ¨é€

#### 3.1 åç«¯ WebSocket
- `WS /ws/workspaces/{name}/logs` - æ—¥å¿—æµ
- è¿›ç¨‹ stdout/stderr æµå¼è½¬å‘

#### 3.2 å‰ç«¯æ—¥å¿—é¡µ
- `pages/BuildLogs.tsx` - æ—¥å¿—æŸ¥çœ‹é¡µ
- `ui/LogViewer.tsx` - æ—¥å¿—æ»šåŠ¨æ˜¾ç¤ºç»„ä»¶
- WebSocket å®¢æˆ·ç«¯è¿æ¥ç®¡ç†

---

## ğŸ“ å®ç°è§„èŒƒ

### ä»£ç é£æ ¼
- **å¤ç”¨ä¼˜å…ˆ**: æå–å…¬å…±é€»è¾‘åˆ° `utils/` æˆ– `services/`
- **ç®€æ´æ¸…æ™°**: é¿å…è¿‡åº¦æŠ½è±¡,ä¿æŒä»£ç ç›´è§‚
- **ç±»å‹å®‰å…¨**: TypeScript ä¸¥æ ¼æ¨¡å¼,Rust å®Œæ•´ç±»å‹
- **æ— ç¡¬ç¼–ç **: API URL, è·¯å¾„ç­‰é€šè¿‡å¸¸é‡/é…ç½®ç®¡ç†

### ç›®å½•ç»“æ„

**åç«¯**
```
backend/service/src/
â”œâ”€â”€ main.rs              # å…¥å£ + è·¯ç”±
â”œâ”€â”€ handlers/            # API å¤„ç†å‡½æ•°
â”‚   â”œâ”€â”€ workspaces.rs    # å·¥ä½œåŒºç›¸å…³
â”‚   â””â”€â”€ logs.rs          # WebSocket æ—¥å¿—
â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ fs.rs            # æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
â”‚   â””â”€â”€ cli.rs           # CLI è°ƒç”¨
â””â”€â”€ models/              # æ•°æ®æ¨¡å‹
    â””â”€â”€ workspace.rs
```

**å‰ç«¯**
```
packages/ui/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”œâ”€â”€ Input.tsx
â”‚   â””â”€â”€ ...
â””â”€â”€ index.ts

app/src/
â”œâ”€â”€ main.tsx             # å…¥å£
â”œâ”€â”€ App.tsx              # æ ¹ç»„ä»¶
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”œâ”€â”€ WorkspaceEditor.tsx
â”‚   â””â”€â”€ BuildLogs.tsx
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api.ts           # HTTP å®¢æˆ·ç«¯
â”‚   â””â”€â”€ ws.ts            # WebSocket å®¢æˆ·ç«¯
â”œâ”€â”€ types/
â”‚   â””â”€â”€ workspace.ts     # ç±»å‹å®šä¹‰
â””â”€â”€ styles/
    â””â”€â”€ index.css        # Tailwind å…¥å£
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹: Phase 1.1 - åç«¯å·¥ä½œåŒº API
**ä»»åŠ¡æ¸…å•**:
1. åˆ›å»º `backend/service/src/models/workspace.rs` - å®šä¹‰ `Workspace` ç»“æ„ä½“
2. åˆ›å»º `backend/service/src/services/fs.rs` - å®ç°æ–‡ä»¶æ‰«æé€»è¾‘
3. ä¿®æ”¹ `main.rs` - æ›¿æ¢å ä½ç¬¦ API,è°ƒç”¨çœŸå®é€»è¾‘
4. æµ‹è¯• API (ä½¿ç”¨ `curl` æˆ– `httpie`)

**éªŒæ”¶æ ‡å‡†**:
- `GET /api/workspaces` è¿”å›å®é™… `.confkit/spaces/` ä¸‹çš„å·¥ä½œåŒº
- `GET /api/workspaces/{name}` è¿”å› YAML é…ç½®å†…å®¹
- `PUT /api/workspaces/{name}` å¯ä»¥æ›´æ–°é…ç½®æ–‡ä»¶

---

## ğŸ”„ è¿­ä»£ç­–ç•¥

æ¯å®Œæˆä¸€ä¸ª Phase:
1. **æµ‹è¯•**: æ‰‹åŠ¨æµ‹è¯•æ‰€æœ‰æ–°å¢åŠŸèƒ½
2. **æäº¤**: Git commit,æ¸…æ™°æè¿°å˜æ›´
3. **è¯„ä¼°**: æ£€æŸ¥ä»£ç è´¨é‡,æ˜¯å¦ç¬¦åˆè§„èŒƒ
4. **ç»§ç»­**: è¿›å…¥ä¸‹ä¸€ä¸ª Phase

ä¿æŒ**å°æ­¥å¿«è·‘**,æ¯æ¬¡å®ç°ä¸€ä¸ªæœ€å°å¯ç”¨åŠŸèƒ½ã€‚
